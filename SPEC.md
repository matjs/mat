# Mat é¡¹ç›®æŠ€æœ¯è§„æ ¼è¯´æ˜

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

**Mat** æ˜¯ä¸€ä¸ªåŸºäº Node.js çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸»è¦ç”¨äºå‰ç«¯å¼€å‘ä¸­çš„æœ¬åœ°æœåŠ¡å™¨æ­å»ºã€ä»£ç†è½¬å‘å’Œèµ„æºç®¡ç†ã€‚å®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¼€å‘æœåŠ¡å™¨ï¼Œç‰¹åˆ«é€‚åˆå‰ç«¯å¼€å‘è¿‡ç¨‹ä¸­çš„è°ƒè¯•å’Œæµ‹è¯•éœ€æ±‚ã€‚

## ğŸ“‹ æ ¸å¿ƒç‰¹æ€§

### 1. **HTTP/HTTPS æœåŠ¡å™¨**
- æ”¯æŒ HTTP å’Œ HTTPS åè®®
- å¯é…ç½®ç«¯å£ã€æ ¹ç›®å½•ç­‰åŸºæœ¬å‚æ•°
- å†…ç½®é™æ€æ–‡ä»¶æœåŠ¡

### 2. **åå‘ä»£ç†åŠŸèƒ½**
- æ”¯æŒå°†æœ¬åœ°è¯·æ±‚ä»£ç†åˆ°è¿œç¨‹æœåŠ¡å™¨
- æ”¯æŒ HTTPS ä»£ç†
- å…·å¤‡ RAP å¹³å°é›†æˆæ”¯æŒ
- æ”¯æŒè¯·æ±‚å¤´ä¿®æ”¹å’Œæ¥æºå˜æ›´
- **NEW: SSE (Server-Sent Events) æ”¯æŒ**: æ–°å¢ä¸“ç”¨æµå¼ä»£ç†å¤„ç†å™¨ï¼Œæ”¯æŒå®æ—¶æ•°æ®æ¨é€å’Œé•¿è¿æ¥

### 3. **Combo URL å¤„ç†**
- æ”¯æŒç±»ä¼¼é˜¿é‡Œ CDN çš„ combo URL åŠŸèƒ½
- å¯ä»¥å°†å¤šä¸ªèµ„æºåˆå¹¶ä¸ºä¸€ä¸ªè¯·æ±‚ (å¦‚ï¼š`/path/??file1.js,file2.js`)
- è‡ªåŠ¨å¤„ç†èµ„æºæ‹†åˆ†å’Œåˆå¹¶

### 4. **URL é‡å†™**
- æ”¯æŒé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼é‡å†™ URL
- æ”¯æŒå‡½æ•°å¼ URL è½¬æ¢
- é€‚ç”¨äºå¼€å‘ç¯å¢ƒåˆ°ç”Ÿäº§ç¯å¢ƒçš„è·¯å¾„æ˜ å°„

### 5. **ä¸­é—´ä»¶æ¶æ„**
- åŸºäº Koa.js æ¡†æ¶æ„å»º
- æ¨¡å—åŒ–çš„ä¸­é—´ä»¶è®¾è®¡
- æ”¯æŒè‡ªå®šä¹‰ä¸­é—´ä»¶æ‰©å±•

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒä¾èµ–
- **Koa.js**: Web æ¡†æ¶åŸºç¡€
- **Orchestrator**: ä»»åŠ¡ç®¡ç†å™¨ (ç±»ä¼¼ Gulp)
- **Liftoff**: CLI å·¥å…·å¯åŠ¨å™¨
- **co-request**: å¼‚æ­¥ HTTP è¯·æ±‚

### ä¸­é—´ä»¶ç³»ç»Ÿ
1. **Error ä¸­é—´ä»¶**: é”™è¯¯å¤„ç†
2. **Logger ä¸­é—´ä»¶**: è¯·æ±‚æ—¥å¿—è®°å½•
3. **Combo ä¸­é—´ä»¶**: Combo URL å¤„ç†
4. **Static ä¸­é—´ä»¶**: é™æ€æ–‡ä»¶æœåŠ¡
5. **Proxy ä¸­é—´ä»¶**: åå‘ä»£ç†
6. **URL ä¸­é—´ä»¶**: URL è§„åˆ™åŒ¹é…å’Œé‡å†™

### é¡¹ç›®ç»“æ„
```
mat/
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ mat                 # CLI å…¥å£æ–‡ä»¶
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ middleware/         # ä¸­é—´ä»¶æ¨¡å—
â”‚       â”œâ”€â”€ combo.js        # Combo URL å¤„ç†
â”‚       â”œâ”€â”€ error.js        # é”™è¯¯å¤„ç†
â”‚       â”œâ”€â”€ logger.js       # æ—¥å¿—è®°å½•
â”‚       â”œâ”€â”€ proxy.js        # åå‘ä»£ç†
â”‚       â”œâ”€â”€ static.js       # é™æ€æ–‡ä»¶æœåŠ¡
â”‚       â””â”€â”€ url.js          # URL è§„åˆ™åŒ¹é…
â”œâ”€â”€ util/                   # å·¥å…·å‡½æ•°
â”œâ”€â”€ index.js               # ä¸»æ¨¡å—
â””â”€â”€ package.json           # é¡¹ç›®é…ç½®
```

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### 1. **å‰ç«¯å¼€å‘è°ƒè¯•**
```javascript
// å¼€å‘ç¯å¢ƒä»£ç†é…ç½®
mat.task('daily', function () {
  mat.url([/\.json/])
    .use(proxy({
      proxyPass: 'your.proxy.host'
    }))
})
```

### 2. **èµ„æºåˆå¹¶æœåŠ¡**
```javascript
// Combo URL å¤„ç†
mat.task('combohandler', function () {
  mat.env({
    combohandler: true
  })
  
  mat.url([/\.js/])
    .rewrite([
      [/-min/g, '']
    ])
})
```

### 3. **ç¯å¢ƒåˆ‡æ¢**
```javascript
// URL é‡å†™å®ç°ç¯å¢ƒåˆ‡æ¢
mat.task('online', function () {
  mat.url([/\.js/])
    .rewrite([
      [/-min\.js/g, '.js']
    ])
})
```

### 4. **NEW: SSE (Server-Sent Events) ä»£ç†**
```javascript
// SSE é•¿è¿æ¥ä»£ç†é…ç½®
mat.task('sse', function () {
  // SSE æ¥å£ä»£ç†ï¼Œæ”¯æŒæµå¼ä¼ è¾“ - é€šè¿‡ Accept å¤´è‡ªåŠ¨æ£€æµ‹
  mat.url([/\/api\/events/, /\/stream/])
    .use(proxy({
      proxyPass: 'http://api.example.com',
      isChangeOrigin: true
    }))
  
  // æˆ–è€…æ˜¾å¼å¯ç”¨ SSE
  mat.url([/\/api\/sse/])
    .sse({
      enabled: true,
      timeout: 0, // æ— è¶…æ—¶é™åˆ¶
      keepAlive: true
    })
    .use(proxy({
      proxyPass: 'http://api.example.com',
      isChangeOrigin: true
    }))
})
```

## ğŸ”§ API æ¥å£

### Mat ç±»ä¸»è¦æ–¹æ³•

#### `mat.env(options)`
é…ç½®è¿è¡Œç¯å¢ƒå‚æ•°
- `port`: æœåŠ¡ç«¯å£
- `root`: é™æ€æ–‡ä»¶æ ¹ç›®å½•
- `isHttps`: æ˜¯å¦å¯ç”¨ HTTPS
- `combohandler`: æ˜¯å¦å¯ç”¨ Combo URL å¤„ç†
- `timeout`: è¯·æ±‚è¶…æ—¶æ—¶é—´
- `limit`: è¯·æ±‚ä½“å¤§å°é™åˆ¶

#### `mat.url(rules)`
åˆ›å»º URL è§„åˆ™åŒ¹é…å™¨
- `rules`: æ­£åˆ™è¡¨è¾¾å¼æ•°ç»„æˆ–å‡½æ•°æ•°ç»„

#### `mat.task(name, fn)`
å®šä¹‰ä»»åŠ¡ (ç»§æ‰¿è‡ª Orchestrator)
- `name`: ä»»åŠ¡åç§°
- `fn`: ä»»åŠ¡æ‰§è¡Œå‡½æ•°

#### `mat.launch()`
å¯åŠ¨æœåŠ¡å™¨

### URL ä¸­é—´ä»¶æ–¹æ³•

#### `url.use(middleware)`
æ·»åŠ ä¸­é—´ä»¶åˆ° URL è§„åˆ™

#### `url.rewrite(rules)`
é…ç½® URL é‡å†™è§„åˆ™
- `rules`: é‡å†™è§„åˆ™æ•°ç»„ `[[pattern, replacement], ...]`

#### `url.sse(sseConfig)` â­ **æ–°å¢**
é…ç½® SSE (Server-Sent Events) æ”¯æŒ
- `sseConfig.enabled`: æ˜¯å¦æ˜¾å¼å¯ç”¨ SSE (boolean)
- `sseConfig.timeout`: SSE ä¸“ç”¨è¶…æ—¶æ—¶é—´ï¼Œ0 è¡¨ç¤ºæ— é™åˆ¶ (number)
- `sseConfig.keepAlive`: æ˜¯å¦ä¿æŒè¿æ¥æ´»è·ƒ (boolean)

## ğŸ“ˆ ç‰ˆæœ¬å†å²

- **1.0.20** (å½“å‰ç‰ˆæœ¬): ç¨³å®šç‰ˆæœ¬ï¼Œå®Œæ•´åŠŸèƒ½æ”¯æŒ
- **0.1.15**: æ”¯æŒ ready å‚æ•°å›è°ƒ
- **0.1.14**: ä¿®å¤ gzip å†…å®¹è§£æé—®é¢˜
- **0.1.13**: å¢åŠ è¶…æ—¶é…ç½®
- **0.1.8-0.1.9**: å¢åŠ  Combo URL æ”¯æŒ
- **0.1.0**: ç¬¬ä¸€ä¸ªç¨³å®šç‰ˆæœ¬ï¼ŒåŸºç¡€åŠŸèƒ½

## ğŸª é€‚ç”¨åœºæ™¯

1. **å‰ç«¯é¡¹ç›®æœ¬åœ°å¼€å‘**: æä¾›é™æ€æ–‡ä»¶æœåŠ¡
2. **æ¥å£ä»£ç†è°ƒè¯•**: ä»£ç†åˆ°å¼€å‘/æµ‹è¯•ç¯å¢ƒçš„ API
3. **èµ„æºåˆå¹¶ä¼˜åŒ–**: å¤„ç†å¤šæ–‡ä»¶åˆå¹¶è¯·æ±‚
4. **è·¨åŸŸé—®é¢˜è§£å†³**: é€šè¿‡ä»£ç†è§£å†³å¼€å‘ä¸­çš„è·¨åŸŸé—®é¢˜
5. **è·¯å¾„æ˜ å°„**: å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒçš„è·¯å¾„è½¬æ¢

## âš¡ æŠ€æœ¯ä¼˜åŠ¿

- **è½»é‡çº§**: ä¾èµ–ç²¾ç®€ï¼Œå¯åŠ¨å¿«é€Ÿ
- **æ‰©å±•æ€§**: åŸºäºä¸­é—´ä»¶çš„æ¶æ„æ˜“äºæ‰©å±•
- **é…ç½®çµæ´»**: æ”¯æŒå¤šç§é…ç½®æ–¹å¼
- **é›†æˆå‹å¥½**: å¯ä½œä¸ºå…¶ä»–å·¥å…·é“¾çš„ä¸€éƒ¨åˆ†
- **ä»»åŠ¡ç®¡ç†**: åŸºäº Orchestrator çš„ä»»åŠ¡ç³»ç»Ÿ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…
```bash
npm install mat
```

### åŸºæœ¬ä½¿ç”¨
```javascript
var mat = require('mat')

// åŸºæœ¬é™æ€æœåŠ¡
mat.task('default', function() {
  mat.env({
    port: 8989,
    root: './'
  })
})

// å¯åŠ¨æœåŠ¡
mat.start(['default'], function() {
  mat.launch()
})
```

### å‘½ä»¤è¡Œä½¿ç”¨
```bash
# å¯åŠ¨é»˜è®¤ä»»åŠ¡
mat

# å¯åŠ¨æŒ‡å®šä»»åŠ¡
mat taskname

# æŒ‡å®šé…ç½®æ–‡ä»¶
mat --matfile path/to/matfile.js

# å¿«é€Ÿä»£ç†æ¨¡å¼
mat -p 8080
```

## ğŸ“ é…ç½®æ–‡ä»¶ç¤ºä¾‹

å…¸å‹çš„ matfile.js:
```javascript
var mat = require('mat')
var proxy = require('mat-proxy')

// å¼€å‘ç¯å¢ƒé…ç½®
mat.task('dev', function() {
  mat.env({
    port: 8989,
    root: './src',
    combohandler: true
  })
  
  // API ä»£ç†
  mat.url([/\/api\//])
    .use(proxy({
      proxyPass: 'http://dev.example.com'
    }))
    
  // é™æ€èµ„æºé‡å†™
  mat.url([/\.js$/])
    .rewrite([
      [/\/build\//, '/src/']
    ])
})

// ç”Ÿäº§ç¯å¢ƒé…ç½®
mat.task('prod', function() {
  mat.env({
    port: 8080,
    root: './dist'
  })
})
```

---

*æœ¬è§„æ ¼è¯´æ˜åŸºäº Mat v1.0.20 ç‰ˆæœ¬åˆ†æç”Ÿæˆ*
